<!DOCTYPE html>
<html lang="en" >
  <head>
    <meta charset="utf-8">
  <meta name="description" content="Test your colorblindness">
    <meta name="keywords" content="Synchoneyes, colorblindness, eyes, test">
    <meta name="author" content="Karampinas Nikolaos, Noulis Aristeidis">
    <link rel="icon" type="image/ico" href="/synchroneyes/images/synchroneyes.ico">
    <link rel="stylesheet" type="text/css" media="all" href="style2.css">
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
     <script type='text/javascript' src='comscript.js'></script>
    <title>Synchroneyes - Test</title>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script>
     var index = 0, find = 0, flag=0, movement=false, test, test_status, question,
     choice, choices, chA, chB, chC,chCor, correct = 0, first15Correct = 0,
     red = 0, green = 0, first_time = true, resultText1,resultText2;

var size = 24;

function start(){
    document.getElementById("warning").setAttribute("style", "visibility:hidden;")
    quiz_status.innerHTML = "Test Your Knowledge in RHCP";
	  buttons_container.innerHTML = "<button  class='button button1 centerize' onclick='play()'>Play</button>";
}

function printResults(){

    if(first15Correct >= 13){
              resultText1=" Your colour vision is considered as adequate.";
          }else if(first15Correct >= 10){
              resultText1=" Your colour vision is considered as normal.";
          }else{
              resultText1=" Your colour vision is considered as deficient.";
          }

    quiz_question.innerHTML = "";
    quiz_answers.innerHTML = "";
    quiz_status.innerHTML = "Test Completed";
    quiz_status.innerHTML += "<h2>You got "+correct+" of "+size+" questions correct</h2>";
    quiz_status.innerHTML += resultText1;
    if(red>=2){
            resultText2=" You might be red-colour blind.";
            quiz_status.innerHTML += resultText2;
        }
    if(green>=2){
            resultText2=" You might be green-colour blind.";
            quiz_status.innerHTML += resultText2;
        }
    quiz_status.innerHTML += " If you have any doubts or questions you should get advice from an ophthalmologist.";
    buttons_container.innerHTML= "<button class='button button1 ' onclick='play()'>Play Again</button>";
	   index = 0;
		correct = 0;
    first15Correct = 0;
    green = 0;
    red = 0;
}

function play(){
	if(index<size){
    loadDoc();
	}else{
		printResults();
		return false;
	}
}


function loadDoc() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      showQuestion(this);
    }
  };
  xhttp.open("GET", "quizData.xml", true);
  xhttp.send();
}

function showQuestion(xml){

  var xmlDoc = xml.responseXML;
  var x = xmlDoc.getElementsByTagName("QUESTION");
  question = x[index].getElementsByTagName("TITLE")[0].childNodes[0].nodeValue;
	chA = x[index].getElementsByTagName("CHOICE_ONE")[0].childNodes[0].nodeValue;
	chB = x[index].getElementsByTagName("CHOICE_TWO")[0].childNodes[0].nodeValue;
	chC = x[index].getElementsByTagName("CHOICE_THREE")[0].childNodes[0].nodeValue;
	chCor = x[index].getElementsByTagName("ANSWER")[0].childNodes[0].nodeValue;

  quiz_status.innerHTML = "Question "+(index+1)+" of "+size;
  quiz_question.innerHTML  = "<img id ='img'>";
  $("#img").attr("src",question);
  warning.innerHTML = "nothing";
	quiz_answers.innerHTML = "<input type='radio' name='option A' value='A' id='A' onclick='markQuestion(id)'>"+chA;
  quiz_answers.innerHTML += "<input type='radio' name='option B' value='B' id='B' onclick='markQuestion(id)' >"+chB;
  quiz_answers.innerHTML += "<input type='radio' name='option C' value='C' id='C' onclick='markQuestion(id)' >"+chC;
	buttons_container.innerHTML = "<button class='button button1' onclick='move()'>Next Answer</button>";

}

function refreshImageBorder(){
  document.getElementById('A').style.borderColor = "grey";
  document.getElementById('B').style.borderColor = "grey";
  document.getElementById('C').style.borderColor = "grey";

}

function markQuestion(element){
  choice = element;
  refreshImageBorder();
  document.getElementById(choice).style.borderColor = "blue";
	find=1;
   movement=true;
   if(first_time){
      	if(choice == chCor){
      		correct++;
          if(index<15){
          first15Correct++;
         }

      }
      	else{
          if (index>=15 && index<=17) {
               if(choice == 'B'){
                 red++;
               }
                if(choice == 'C'){
                  green++;
                }
              }
      	}
   }
}



function move(){
	if(movement)
	{ index++;
	  find=0;
	  movement=false;
    first_time = true;
    document.getElementById("warning").setAttribute("style", "visibility:hidden;")
	  play();
	}else{
    warning.innerHTML = "Please choose an answer!";
    document.getElementById("warning").setAttribute("style", "visibility:visible;");
	}
}

window.addEventListener("load", start, false);
</script>
  </head>
<body id="news_b">
<header>
<div class="top">
		<img id="logo"	src="images/logo.png" alt="Synchroneyes logo">
	</div>
 <nav>
          <ul>
           <li><a href="index.html">Home</a></li>
           <li><a class="active" href="test.html">Test</a></li>
           <li><a href="comments.php">Comments</a></li>
          </ul>
</nav>
</header>
<div class="container">
  <div id="container_quiz">
    <div id="quiz_status"> </div>
    <div id="quiz_question"></div>
     <div id="quiz_answers"></div>
      <div id="warning"></div>
       <div id="buttons_container"></div>
    </div>
</div>

<footer class="footer">Â© 2016. This page was created for academic purposes on the subject of Software Technology at the Aristotle University of Thessaloniki.</footer>
</body>
</html>
